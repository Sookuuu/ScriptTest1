-- LocalScript (colocar em StarterPlayerScripts)
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local player = Players.LocalPlayer
local camera = workspace.CurrentCamera

-- Config
local MIN_FOV = 30
local MAX_FOV = 120
local DEFAULT_FOV = 70
local TOGGLE_KEY = Enum.KeyCode.K -- tecla pra mostrar/ocultar a GUI

-- cria GUI
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "FOVChangerGui"
screenGui.ResetOnSpawn = false
screenGui.Parent = player:WaitForChild("PlayerGui")

local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 360, 0, 110)
mainFrame.Position = UDim2.new(0.5, -180, 0.85, -55)
mainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
mainFrame.BackgroundTransparency = 0.15
mainFrame.BackgroundColor3 = Color3.fromRGB(20,20,20)
mainFrame.BorderSizePixel = 0
mainFrame.Parent = screenGui
mainFrame.LayoutOrder = 1
mainFrame.Modal = false

local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, -16, 0, 28)
title.Position = UDim2.new(0, 8, 0, 6)
title.BackgroundTransparency = 1
title.Text = "FOV"
title.Font = Enum.Font.SourceSansBold
title.TextSize = 20
title.TextColor3 = Color3.fromRGB(255,255,255)
title.TextXAlignment = Enum.TextXAlignment.Left
title.Parent = mainFrame

local valueLabel = Instance.new("TextLabel")
valueLabel.Size = UDim2.new(0, 76, 0, 28)
valueLabel.Position = UDim2.new(1, -84, 0, 6)
valueLabel.BackgroundTransparency = 1
valueLabel.Text = tostring(DEFAULT_FOV)
valueLabel.Font = Enum.Font.SourceSansBold
valueLabel.TextSize = 20
valueLabel.TextColor3 = Color3.fromRGB(255,255,255)
valueLabel.TextXAlignment = Enum.TextXAlignment.Right
valueLabel.Parent = mainFrame

-- barra do slider
local sliderBar = Instance.new("Frame")
sliderBar.Size = UDim2.new(1, -16, 0, 18)
sliderBar.Position = UDim2.new(0, 8, 0, 50)
sliderBar.BackgroundColor3 = Color3.fromRGB(60,60,60)
sliderBar.BorderSizePixel = 0
sliderBar.Parent = mainFrame
sliderBar.AnchorPoint = Vector2.new(0,0)

local sliderFill = Instance.new("Frame")
sliderFill.Size = UDim2.new(0, 0, 1, 0)
sliderFill.Position = UDim2.new(0, 0, 0, 0)
sliderFill.BackgroundColor3 = Color3.fromRGB(120,120,120)
sliderFill.BorderSizePixel = 0
sliderFill.Parent = sliderBar

local knob = Instance.new("ImageButton")
knob.Name = "Knob"
knob.Size = UDim2.new(0, 18, 0, 32)
knob.Position = UDim2.new(0, -9, 0.5, -16)
knob.AnchorPoint = Vector2.new(0.5, 0.5)
knob.BackgroundTransparency = 1
knob.Image = "rbxassetid://3570695787" -- círculo básico
knob.ImageColor3 = Color3.fromRGB(200,200,200)
knob.Parent = sliderBar

local quickMinus = Instance.new("TextButton")
quickMinus.Size = UDim2.new(0, 28, 0, 28)
quickMinus.Position = UDim2.new(0, 8, 1, -36)
quickMinus.Text = "-"
quickMinus.Font = Enum.Font.SourceSansBold
quickMinus.TextSize = 20
quickMinus.Parent = mainFrame

local quickPlus = Instance.new("TextButton")
quickPlus.Size = UDim2.new(0, 28, 0, 28)
quickPlus.Position = UDim2.new(1, -36, 1, -36)
quickPlus.AnchorPoint = Vector2.new(0,0)
quickPlus.Text = "+"
quickPlus.Font = Enum.Font.SourceSansBold
quickPlus.TextSize = 20
quickPlus.Parent = mainFrame

-- estado
local dragging = false

-- funs utils
local function clamp(val, a, b)
	return math.max(a, math.min(b, val))
end

local function setFOVFromPercent(p)
	p = clamp(p, 0, 1)
	local fov = MIN_FOV + (MAX_FOV - MIN_FOV) * p
	camera.FieldOfView = fov
	valueLabel.Text = tostring(math.floor(fov + 0.5))
	-- atualiza visuais
	sliderFill.Size = UDim2.new(p, 0, 1, 0)
	knob.Position = UDim2.new(p, 0, 0.5, -16)
end

local function percentFromPosition(absX)
	local absPos = sliderBar.AbsolutePosition
	local absSize = sliderBar.AbsoluteSize
	local relative = (absX - absPos.X) / absSize.X
	return clamp(relative, 0, 1)
end

-- inicia com valor padrão
camera.FieldOfView = DEFAULT_FOV
local initPercent = (DEFAULT_FOV - MIN_FOV) / (MAX_FOV - MIN_FOV)
setFOVFromPercent(initPercent)

-- eventos de mouse/drag
knob.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 then
		dragging = true
		UserInputService.MouseIconEnabled = true
	end
end)

UserInputService.InputEnded:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 then
		dragging = false
		UserInputService.MouseIconEnabled = true
	end
end)

UserInputService.InputChanged:Connect(function(input)
	if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
		local p = percentFromPosition(input.Position.X)
		setFOVFromPercent(p)
	end
end)

-- clique direto na barra
sliderBar.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 then
		local p = percentFromPosition(input.Position.X)
		setFOVFromPercent(p)
	end
end)

-- botões +/- rápidos
quickMinus.MouseButton1Click:Connect(function()
	setFOVFromPercent(((camera.FieldOfView - 1) - MIN_FOV) / (MAX_FOV - MIN_FOV))
end)
quickPlus.MouseButton1Click:Connect(function()
	setFOVFromPercent(((camera.FieldOfView + 1) - MIN_FOV) / (MAX_FOV - MIN_FOV))
end)

-- tecla pra esconder/mostrar
UserInputService.InputBegan:Connect(function(input, gameProcessed)
	if gameProcessed then return end
	if input.KeyCode == TOGGLE_KEY then
		screenGui.Enabled = not screenGui.Enabled
	end
end)

-- touch support (toque na barra)
sliderBar.InputChanged:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.Touch then
		local p = percentFromPosition(input.Position.X)
		setFOVFromPercent(p)
	end
end)
